<html xmlns:th="http://www.thymeleaf.org">
<head>
	<script th:src="@{/js/front/layer.js}"></script>
</head>

	<th:block th:fragment="stdinForm" th:object="${stdinForm}" >
		<script th:src="@{/js/front/stdin.js}"></script>
		<script>
		function delrow(e) {
			let rowIndex = e.parentNode.parentNode.rowIndex;
			let table = document.getElementById('addItemTable');


			table.deleteRow(rowIndex);

			updateItemData(table);
		};
	</script>
		<script>
		document.addEventListener('DOMContentLoaded', function() {
			const addItemForm = document.getElementById('addItemForm');

			addItemForm.addEventListener("click", function() {
					let itemInfo = [];
					itemInfo[0] = document.getElementById('item_cd');
					const itemCd = itemInfo[0].value;
					itemInfo[1] = document.getElementById('item_tmp');
					itemInfo[2] = document.getElementById('loc_tmp');
					itemInfo[3] = document.getElementById('amount');
					itemInfo[4] = document.getElementById('normal');
					itemInfo[5] = document.getElementById('fault');

					for(var i in itemInfo) {
						console.log(itemInfo[i]);
						if(itemInfo[i].value == '') {
							alert('상품 정보를 올바르게 기입해주세요.');
							return;
						}
					}




					if(document.getElementById('addItemTable') == null) {
						const addForm = document.getElementById('addForm');
						addForm.innerHTML = "<table id='addItemTable'><th>상품코드</th><th>상품명</th><th>로케이션</th><th>A</th><th>N</th><th>F</th><th>삭제</th><tr></tr></table>";
					};

					const table = document.getElementById('addItemTable');
					const itemData = document.getElementById('itemData');

					const newRow = table.insertRow();
					for(var i in itemInfo) {
						newRow.insertCell(i).innerText = itemInfo[i].value;
						itemInfo[i].value = null;
					}
					updateItemData(table);

					newRow.insertCell().innerHTML = "<button type='button' class='delBtn' id='delBtnId' onclick='delrow(this)'>삭제</button>";
					document.getElementById('delBtnId').dataset.delcd = itemCd;
			});
		});
	</script>

		<script>
		function updateItemData() {
			var itemData = document.getElementById('itemData');
			const table = document.getElementById('addItemTable');
			var rowList = table.rows;

			console.log('rowListNum : ' + rowList.length);

			var str = '';
			itemData.value = null;
			for (var i = 2; i < rowList.length; i++) {
				for (var j = 0; j < 6; j++){
					itemData.value += rowList[i].cells[j].innerHTML + ',';
				}
				itemData.value += '/';
			}
			console.log(itemData);
		};
	</script>
		<input type="hidden" th:field="*{stdinNum}">
		<input type="hidden" th:field="*{itemData}" id="itemData">




		<div>
			<dt th:text="#{stdin_dt}" class="require_item"></dt>
			<input type="date" name="stdinDt" th:value="${#temporals.format(stdinForm.stdinDt, 'yyyy-MM-dd')}" th:placeholder="#{stdin_dt}">
			<div class="errors" th:each="err : ${#fields.errors('stdinDt')}" th:text="${err}"></div>
		</div>

		<br>

		<div>
			<dt th:text="#{clnt}" class="require_item"></dt>
			<input type="text" id="clnt_cd" th:field="*{clntCd}" readonly style="background:#d5d5d5"/>
			<input type="text" list="clnt" id="clnt_tmp" name="clnt_tmp" placeholder="고객사 명" onchange="UpdateClnt()" th:field="*{clntNm}"/>
			<datalist id="clnt">
				<select id="clnt_sel">
					<option th:each="clnt : ${clntList}" th:label="${clnt.clntCd}" th:value="${clnt.clntNm}">
					</option>
				</select>
			</datalist>
			<div class="errors" th:each="err : ${#fields.errors('clntCd')}" th:text="${err}"></div>
		</div>

		<br>

		<input type="hidden" name="status" th:value="01">

		<br>

		<div>
			<dt th:text="#{item}" class="require_item"></dt>
			<input type="text" id="item_cd" th:field="*{itemCd}" readonly style="background:#d5d5d5"/>
			<input type="text" list="item" id="item_tmp" name="item_tmp" placeholder="상품명" onchange="UpdateItem()" th:field="*{itemNm}"/>
			<datalist id="item">
				<select id="item_sel">

				</select>
			</datalist>
			<div class="errors" th:each="err : ${#fields.errors('itemCd')}" th:text="${err}"></div>
		</div>

		<br>

		<div>
			<dt th:text="#{loc}" class="require_item"></dt>
			<input type="text" list="loc" id="loc_tmp" name="loc_tmp" placeholder="로케이션" th:field="*{locCd}"/>
			<datalist id="loc">
				<select id="loc_sel">

				</select>
			</datalist>
			<div class="errors" th:each="err : ${#fields.errors('locCd')}" th:text="${err}"></div>
		</div>

		<br>

		<div>
			<dt th:text="#{beforeStdin}" class="require_item"></dt>
			<input type="text" name="beforeStdin" th:field="*{beforeStdin}" th:placeholder="#{beforeStdin}" id="amount" readonly style="background:#d5d5d5"/>
			<div class="errors" th:each="err : ${#fields.errors('beforeStdin')}" th:text="${err}"></div>
		</div>

		<br>

		<div>
			<dt th:text="#{normal}" class="require_item"></dt>
			<input type="number" name="normal" th:field="*{normal}" th:placeholder="#{normal}" id="normal" onchange="sum()"/>
			<div class="errors" th:each="err : ${#fields.errors('normal')}" th:text="${err}"></div>
		</div>

		<div>
			<dt th:text="#{fault}" class="require_item"></dt>
			<input type="number" name="fault" th:field="*{fault}" th:placeholder="#{fault}" id="fault" onchange="sum()"/>
			<div class="errors" th:each="err : ${#fields.errors('fault')}" th:text="${err}"></div>
		</div>

		<button type="button" id="addItemForm">상품 추가</button>

		<div id="addForm"></div>

		<div>
			<dt th:text="#{remk}" class="require_item"></dt>
			<textarea name="remark" th:field="*{remark}" th:placeholder="#{remark}"></textarea>
			<div class="errors" th:each="err : ${#fields.errors('remark')}" th:text="${err}"></div>
		</div>
	</th:block>
</html>